---
gettitle: "coding-aRmy_module4"
author: "coding-aRmy"
date: "2022-09-30"
output: html_document
bibliography: BIOL2140.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,include=FALSE}
library(tidyverse) #always
library(ape) #for evo analysis
library(nlme) #ditto
library(MuMIn) #for AIC
library(geiger) #for eco analysis
library(knitr) #for knitting options
```

# Introduction

The purpose of this project was to determine whether hindlimb length varies between ecomorphs within the genus *Anolis*. By using a phylogenetic tree of 46 species of anole lizards [@poe2017phylogenetic] and analyzing morphological and ecomorphological data of these species [@hagey2017there], it was determined that hind limb length varies with phylogenetic relationship, not simply allometry.

<center>
[![An anolis lizard](https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Green_anole.jpg/320px-Green_anole.jpg)](https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Green_anole.jpg/320px-Green_anole.jpg)
</center>


# Methods

The data sets obtained from @hagey2017there were log transformed and two linear models were constructed in order to assess the effect of perch height and diameter on hindlimb length. The residuals of these data were calculated and plotted against the discrete factors in order to discover how both perch diameter and height affect the hindlimb-SVL relationship.The anole phylogenetic tree from @poe2017phylogenetic was used to construct phylogenetic least squares models of the hindlimb-SVL relationships using all possible combinations of the two covariates: 

* PGLS model with the hindlimb-SVL relationship + perch height
* PGLS model with the hindlimb-SVL relationship + perch diameter
* PGLS model with the hindlimb-SVL relationship + perch height + perch diameter

The fit of each model was assessed using AICc and AICw in order to determine whether one or both of the covariates is a significant predictor of hindlimb length in a phylogenetic context. A facet grid was produced in order to visualize the effect of perch height, perch diameter, and ecomorph on the hindlimb residuals of the best fitting PGLS model.

# Results

```{r,"load the data"}
anole <- read_csv("anole.dat.csv")
anole.eco <- read_csv("anole.eco.csv")
anole.tree <- read.tree("anole.tre")
```

```{r, "join, filter, mutate to log"}
anole2 <- anole%>%
left_join(anole.eco)%>%
  filter(!Ecomorph%in%c("U","CH"))%>%
  na.omit()

anole.log <- anole2%>%
  mutate_at(c("SVL", "HTotal","PH","ArbPD"),log)
```

```{r, "PGLS models"}
### phylogenetic GLS models

#PGLS under BM, no ecomorph
pgls.BM1 <- gls(HTotal ~SVL, correlation = corBrownian(1,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under BM, with ecomorph
pgls.BM2 <- gls(HTotal ~SVL * Ecomorph2, correlation = corBrownian(1,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under OU, no ecomorph
pgls.OU1 <- gls(HTotal ~SVL, correlation = corMartins(0,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under OU, with ecomorph
pgls.OU2 <- gls(HTotal ~SVL * Ecomorph2, correlation = corMartins(0,phy = anole.tree,form=~Species),data = anole.log, method = "ML")
```

```{r, "AIC"}
#AIC operations
anole.phylo.aic <- AICc(pgls.BM1,pgls.BM2,pgls.OU1,pgls.OU2)
anole.phylow.aicw <- aicw(anole.phylo.aic$AICc)
```

```{r, "add residuals"}
#add phylo-corrected residuals
anole.log <- anole.log%>%
  mutate(phylo.res=residuals(pgls.BM2))
```

```{r,"plot residuals", fig.cap="Boxplot of phylogenetically corrected hindlimb residuals versus anole ecomorph"}
#plot residuals
p.eco.phylo <- anole.log%>%
ggplot(aes(x=Ecomorph2,y=phylo.res)) +geom_boxplot() +stat_summary(fun=mean, geom="point", size=3)

print(p.eco.phylo)

```


# Discussion

# Author Contributions

# References
